<!DOCTYPE HTML>

    <html lang="zh-Hans">
  
<head>
  <meta charset="utf-8">
  
  <title>How to create, debug and test an extension written in C for PostgreSQL | David&#39;s Blog</title>
  <meta name="author" content="David Zhang">
  
  <meta name="description" content="knowledge is power">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="How to create, debug and test an extension written in C for PostgreSQL"/>
  <meta property="og:site_name" content="David&#39;s Blog"/>

  
    <meta property="og:image" content=""/>
  

  
    <meta http-equiv="Content-Language" content="zh-Hans"/>
  

  <link href="/img/favicon.png" rel="icon">
  
    <link rel="apple-touch-icon" href="/img/apple-icon.ico">
    <link rel="apple-touch-icon-precomposed" href="/img/apple-icon.ico">
    

  <link rel="alternate" href="/atom.xml" title="David&#39;s Blog" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">

  
  <!-- Chinese readability improment -->
  <style type="text/css">
    article {font-weight: 400;letter-spacing: .01rem;}
    article .entry{line-height:2;}
  </style>
  
  
  <style type="text/css">
  /* Tim Pietrusky advanced checkbox hack (Android <= 4.1.2) */
body{ -webkit-animation: bugfix infinite 1s; }
@-webkit-keyframes bugfix { from {padding:0;} to {padding:0;} }
</style>

  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-48887175-1', 'auto');
  ga('send', 'pageview');

</script>



  
    <!-- 360 Font and Baidu CDN in China -->
    
      <link href='//fonts.googleapis.com/css?family=Open+Sans:300,400|Playball' rel='stylesheet' type='text/css'>
    
  <link href='//apps.bdimg.com/libs/fontawesome/4.1.0/css/font-awesome.css' rel='stylesheet' type='text/css'>
  <script src="//libs.baidu.com/jquery/1.11.1/jquery.min.js"></script>
  



<!-- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
<meta name="generator" content="Hexo 4.2.0"></head>


<body>
  <header id="header" class="inner"><div class="padding">
	<div class="alignleft logo">
	  <h1><a href="/">David&#39;s Blog</a></h1>
	</div>
	<nav id="main-nav" class="alignright">
		<input type="checkbox" id="toggle" />
		<label for="toggle" class="toggle" data-open="Main Menu" data-close="Close Menu" onclick><i class="fa fa-bars"></i></label>
	  <ul class="menu">
	    
	      <li><a href="/">Home</a></li>
	    
	      <li><a href="/archives">Archives</a></li>
	    
	    
	  </ul>
	</nav>
	<div class="clearfix"></div>
</div>
</header>
  <div id="page-heading-wrap">
  	<div class="inner">
      <div class="padding">
    		
          <h1>How to create, debug and test an extension written in C for PostgreSQL</h1>
          <ul>
            <li>
              <span class="heading-span">Posted on: </span>
              <time datetime="2019-12-31T08:00:00.000Z">2019-12-31</time>
            </li>
            
              <li>
                <span class="heading-span">By: </span>

                
                  <a href="/" target="_blank">David Zhang</a>

                

              </li>
            
            <li>
              <span class="heading-span">With: </span>
              
            </li>
          </ul>
        
      </div>
  	</div>
  </div>
  <div id="content" class="inner">
    <div id="main-col" class="alignleft"><div id="wrapper" class="padding"><article class="post">
  
  
    <div class="post-content">
  
      
      <div class="entry">
        
          <h4 id="1-Overview"><a href="#1-Overview" class="headerlink" title="1. Overview"></a>1. Overview</h4><p>PostgreSQL is one of the most popular free open-source relational database management systems in the world. Other than complies to SQL standard, PostgreSQL also provides a great extensibility which allows users to define their own extensions. With such a great feature, PostgreSQL is not only a database but also an application development platform. In this tutorial, we will go through the entire process about creating an extension, running test against this extension, and debugging the extneson using Eclipse.</p>
<h4 id="2-Create-an-extension"><a href="#2-Create-an-extension" class="headerlink" title="2. Create an extension"></a>2. Create an extension</h4><p>To create an extension in PostgreSQL, you need at least two files: <code>control</code> file and <code>SQL script</code> file. The <code>control</code> file uses a naming convention <code>extension_name.control</code>. let‘s create an extension call <code>get_sum</code>, then the confile file should contain the basic information like below.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ cat get_sum.control </span><br><span class="line"># get_sum postgresql extension</span><br><span class="line">comment &#x3D; &#39;simple sum of two integers for postgres extension using c&#39;</span><br><span class="line">default_version &#x3D; &#39;0.0.1&#39;</span><br><span class="line">module_pathname &#x3D; &#39;$libdir&#x2F;get_sum&#39;</span><br><span class="line">relocatable &#x3D; false</span><br></pre></td></tr></table></figure>
<ul>
<li><p><code>comment</code> comments about this extension</p>
</li>
<li><p><code>default_version</code> the version of this extension which is also part of the SQL script file</p>
</li>
<li><p><code>module_pathname</code> specifies the shared library path for this extension</p>
</li>
</ul>
<p>The <code>SQL script</code> file must be named as <code>extension_name--version.sql</code>.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ cat get_sum--0.0.1.sql </span><br><span class="line">--complain if script is sourced in psql, rather than via CREATE EXTENSION</span><br><span class="line">\echo Use &quot;CREATE EXTENSION get_sum&quot; to load this file. \quit</span><br><span class="line"> </span><br><span class="line">CREATE OR REPLACE FUNCTION get_sum(int, int) RETURNS int</span><br><span class="line">AS &#39;$libdir&#x2F;get_sum&#39;</span><br><span class="line">LANGUAGE C IMMUTABLE STRICT;</span><br></pre></td></tr></table></figure>
<p>The second line is to avoid loading this SQL script using <code>psql</code>, and the rest declares the <code>get_sum</code> function will be created in shared library using c language.</p>
<p>Typically, an extension not only defines new objects, but also adds new logic to deal with those new objects. To boost the performance, you should write the logic in C code with a <code>Makefile</code>.  PostgreSQL provides a build infrastructure for extension called <code>PGXS</code>, which uses a global variable <code>USE_PGXS</code> to include the global <code>PGXS</code> makefiles. One typical <code>Makefile</code> example found in PostgreSQL is something like below. </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">MODULE_big &#x3D; dblink</span><br><span class="line">… … </span><br><span class="line"></span><br><span class="line">ifdef USE_PGXS</span><br><span class="line">PG_CONFIG &#x3D; pg_config</span><br><span class="line">PGXS :&#x3D; $(shell $(PG_CONFIG) --pgxs)</span><br><span class="line">include $(PGXS)</span><br><span class="line">else</span><br><span class="line">SHLIB_PREREQS &#x3D; submake-libpq</span><br><span class="line">subdir &#x3D; contrib&#x2F;dblink</span><br><span class="line">top_builddir &#x3D; ..&#x2F;..</span><br><span class="line">include $(top_builddir)&#x2F;src&#x2F;Makefile.global</span><br><span class="line">include $(top_srcdir)&#x2F;contrib&#x2F;contrib-global.mk</span><br><span class="line">endif</span><br></pre></td></tr></table></figure>
<p>With <code>PGXS</code> build infrastructure, you can build your extension by simply typing <code>make</code> If you put your extension under the <code>contrib</code> folder within PostgreSQL source tree, or you have to  specify the <code>PG_CONFIG</code> to tell the <code>make</code> command where to find out the <code>pg_config</code> If you put your extension somewhere else.</p>
<p>In the latest PostgreSQL official document, the assumption that an extension should be under the PostgreSQL source tree has been removed. The reason is that there are more and more extension coming from the Internet, and it is not easy to manage so many extensions within PostgreSQL source tree. Let’s follow the latest instruction to build our <code>Makefile</code>.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ cat Makefile </span><br><span class="line">MODULES &#x3D; get_sum</span><br><span class="line">EXTENSION &#x3D; get_sum 	# the extersion&#39;s name</span><br><span class="line">DATA &#x3D; get_sum--0.0.1.sql	# script file to install</span><br><span class="line">REGRESS &#x3D; get_sum_test  	# the test script file</span><br><span class="line"> </span><br><span class="line"># for posgres build</span><br><span class="line">PG_CONFIG &#x3D; pg_config</span><br><span class="line">PGXS :&#x3D; $(shell $(PG_CONFIG) --pgxs)</span><br><span class="line">include $(PGXS)</span><br></pre></td></tr></table></figure>
<ul>
<li><p><code>MODUELS</code> specifies the shared object can be used in psql</p>
</li>
<li><p><code>EXTENSION</code> specifies the extension name</p>
</li>
<li><p><code>DATA</code> specifies the SQL scripts</p>
</li>
<li><p><code>REGRESS</code> specifies the regression test script file</p>
</li>
</ul>
<p>The rest is following the latest recommendation from postgreSQL official <a href="https://www.postgresql.org/docs/current/extend-pgxs.html" target="_blank" rel="noopener">website</a>. In other words, we should always provide the <code>PG_CONFIG</code> when building or testing the extension.  </p>
<p>Once the <code>Makefile</code> is set, you need to create a C file. In this tutorial, we build a simple <code>get_sum</code> function to explain how to add a C file into the extension.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">$ cat get_sum.c</span><br><span class="line">#include &quot;postgres.h&quot;</span><br><span class="line">#include &quot;fmgr.h&quot;</span><br><span class="line"></span><br><span class="line">PG_MODULE_MAGIC;</span><br><span class="line"></span><br><span class="line">PG_FUNCTION_INFO_V1(get_sum);</span><br><span class="line"></span><br><span class="line">Datum</span><br><span class="line">get_sum(PG_FUNCTION_ARGS)</span><br><span class="line">&#123;</span><br><span class="line">    bool isnull, isnull2;</span><br><span class="line"></span><br><span class="line">    isnull &#x3D; PG_ARGISNULL(0);</span><br><span class="line">    isnull2 &#x3D; PG_ARGISNULL(1);</span><br><span class="line">    if (isnull || isnull2)</span><br><span class="line">      ereport( ERROR,</span><br><span class="line">               ( errcode(ERRCODE_FEATURE_NOT_SUPPORTED),</span><br><span class="line">               errmsg(&quot;two and only two integer values are required as input&quot;)));</span><br><span class="line"></span><br><span class="line">    int32 a &#x3D; PG_GETARG_INT32(0);</span><br><span class="line">    int32 b &#x3D; PG_GETARG_INT32(1);</span><br><span class="line">    int32 sum;</span><br><span class="line"></span><br><span class="line">    sum &#x3D; a + b;</span><br><span class="line"></span><br><span class="line">    PG_RETURN_INT32(sum);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Here, the header file <code>postgres.h</code> includes most of the basic stuff needed for interfacing with Postgres. It should be included in every C-File when declares Postgres functions. The header file <code>fmgr.h</code> needs to be included in order to use <code>PG_GETARG_XXX</code>, <code>PG_RETURN_XXX</code> and  <code>PG_ARGISNULL</code> macros. The details about the macros are defined <a href="https://www.postgresql.org/docs/current/xfunc-c.html" target="_blank" rel="noopener">here</a>. This extension function is declared as <code>get_sum</code> with two integers as input parameters, and the result is the sum of these two input parameters.</p>
<h4 id="3-Test-an-extension"><a href="#3-Test-an-extension" class="headerlink" title="3. Test an extension"></a>3. Test an extension</h4><p>In order to verify this extension, we need to follow PostgreSQL regression test framework to add some test cases. First, we need to create a folder named as <code>sql</code>, which contains the SQL test scripts need to be run.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">$ cat sql&#x2F;get_sum_test.sql </span><br><span class="line">CREATE EXTENSION get_sum;</span><br><span class="line">SELECT get_sum(1::INT, 1::INT);</span><br><span class="line">SELECT get_sum(101::INT, 202::INT);</span><br><span class="line">SELECT get_sum(0::INT, 0::INT);</span><br><span class="line">SELECT get_sum(-1::INT, 0::INT);</span><br><span class="line">SELECT get_sum(-1::INT, -1::INT);</span><br><span class="line">SELECT get_sum(-101::INT, -202::INT);</span><br><span class="line">SELECT get_sum(NULL::INT, 11::INT);</span><br><span class="line">SELECT get_sum(-1::INT, NULL::INT);</span><br><span class="line">SELECT get_sum(0::INT, 2147483647::INT);</span><br><span class="line">SELECT get_sum(-2147483648::INT, 0::INT);</span><br><span class="line">SELECT get_sum(2147483647::INT, 2147483647::INT);</span><br><span class="line">SELECT get_sum(-2147483648::INT, -2147483648::INT);</span><br><span class="line">SELECT get_sum(-2147483648::INT, 2147483647::INT);</span><br><span class="line">SELECT get_sum(2147483647::INT, -2147483648::INT);</span><br><span class="line">SELECT get_sum(111111111111111::INT, 222222222222222::INT);</span><br></pre></td></tr></table></figure>
<p>Then we need to create another folder called <code>expected</code>, as the name indicated, it holds the expected output corresponding to the test SQL script. To build the expected output, as <a href="https://www.postgresql.org/docs/current/extend-pgxs.html" target="_blank" rel="noopener">recommended</a> by postgresSQL: run the test once, a results folder will be generated with the test results named as script_name.out, check the result to see if it is what you expected, then simply copy this result file to <code>expected</code> folder. If you run the test again, the regress test framework will compare a new test results output against the file in <code>expected</code> folder, if any difference found, then a .diff file will be created. Now, let’s run a test.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd crontrib&#x2F;get_sum&#x2F;</span><br><span class="line">make PGUSER&#x3D;postgres PG_CONFIG&#x3D;~&#x2F;eclipse-workspace&#x2F;postgres&#x2F;bin&#x2F;pg_config install</span><br></pre></td></tr></table></figure>
<p>Build and install the extension including shared library, contorl and SQL script files, then run installcheck to test the extension function using the SQL test scripts.  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make PGUSER&#x3D;postgres PG_CONFIG&#x3D;~&#x2F;eclipse-workspace&#x2F;postgres&#x2F;bin&#x2F;pg_config installcheck</span><br></pre></td></tr></table></figure>

<p>If the extension function works properly, then you should see the message like below,</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;home&#x2F;david&#x2F;eclipse-workspace&#x2F;postgres&#x2F;lib&#x2F;pgxs&#x2F;src&#x2F;makefiles&#x2F;..&#x2F;..&#x2F;src&#x2F;test&#x2F;regress&#x2F;pg_regress --inputdir&#x3D;.&#x2F; --bindir&#x3D;&#39;&#x2F;home&#x2F;david&#x2F;eclipse-workspace&#x2F;postgres&#x2F;bin&#39; --dbname&#x3D;contrib_regression get_sum_test  	</span><br><span class="line">(using postmaster on Unix socket, default port)</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; dropping database &quot;contrib_regression&quot; &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">DROP DATABASE</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; creating database &quot;contrib_regression&quot; &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">CREATE DATABASE</span><br><span class="line">ALTER DATABASE</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; running regression test queries        &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">test get_sum_test                 ... ok           24 ms</span><br><span class="line"></span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line"> All 1 tests passed. </span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br></pre></td></tr></table></figure>


<h4 id="4-Debug-an-extension"><a href="#4-Debug-an-extension" class="headerlink" title="4. Debug an extension"></a>4. Debug an extension</h4><p>This <code>get_sum</code> is a very simple example to show the basic when creating a new extension from scratch. In reality, the extension will be way complicated, and you might need to keep debugging the extension until it works as designed. If you follow <a href="https://idrawone.github.io/postgresql/eclipse/debug/2019/12/30/How-to-build-PostgreSQL-source-code-using-Eclipse-on-Ubuntu-18.04.html">my previous post</a>, then we can use Eclipse to debug this extension. </p>
<p>First, turn on a Linux terminal and start the <code>postgers</code> services, </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ pg_ctl -D $HOME&#x2F;pg12data&#x2F;data&#x2F; -l logfile start</span><br></pre></td></tr></table></figure>

<p>And then start a <code>psql</code> connection,</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ psql -U postgres</span><br><span class="line">psql (12.1)</span><br><span class="line">Type &quot;help&quot; for help.</span><br></pre></td></tr></table></figure>

<p>Now, create the extension for <code>get_sum</code>,</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">postgres&#x3D;# CREATE EXTENSION get_sum;</span><br><span class="line">CREATE EXTENSION</span><br></pre></td></tr></table></figure>

<p>Turn on another terminal, run <code>ps -ef |grep postgres</code> to find out the pid of the <code>postgres</code> which is dealing with requests coming from current <code>psql</code> connection.</p>
<p>Switch back to the <code>Eclipse</code>, right click on project, select <code>Debug As</code>, then select <code>Debug Configurations…</code>. Fill in the information as shown below then click <code>Debug</code>.</p>
<p><img src="/images/img/attach-postgres.png" alt="GitHub Logo"></p>
<p>A window will pop up like below for you to choose the right progres to attach.<br><img src="/images/img/find-postgres-server2.png" alt="GitHub Logo"></p>
<p>Switch to the <code>psql</code> terminal, then type a query to use this extension, for example,</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">postgres&#x3D;# select get_sum(111, 222);</span><br></pre></td></tr></table></figure>

<p>The terminal should be frozen immediately. Switch back to <code>Eclipse</code>, and you should see the <code>postgres</code> stopped inside <code>get_sum</code> c function. If you type <code>bt</code> from the <code>Debugger Console</code>, then the <code>backtrace</code> should show up like below and you can dig into it to see how the extension is eventually called.<br><img src="/images/img/debugger-console-bt2.png" alt="GitHub Logo"></p>
<p>Now, you can try to print out the input variables and the result before and after, and compare with the <code>psql</code> console input and output. If anything goes wrong, you use Elipse to find out the issue and fix the extension code from there. </p>
<p>Below is the Eclipse debugging message,<br><img src="/images/img/eclipse-step-in.png" alt="GitHub Logo"></p>
<p>This is the <code>psql</code> console screenshot,<br><img src="/images/img/psql-console-get-sum.png" alt="GitHub Logo"></p>
<p>All the source code used in this tutorial is available <a href="https://github.com/idrawone/get_sum.git" target="_blank" rel="noopener">here</a></p>
<h4 id="5-Summary"><a href="#5-Summary" class="headerlink" title="5. Summary"></a>5. Summary</h4><p>In this blog, we discussed how to create an extension from scratch within <code>PGXS</code> build infrastrature, how to create some test cases to test the extension, and we also covered the procedure of debugging an extension using Eclipse. </p>
<p><em><strong>Reference:</strong></em></p>
<p><a href="https://www.highgo.ca/2019/10/01/a-guide-to-create-user-defined-extension-modules-to-postgres/" target="_blank" rel="noopener">1. A Guide to Create User-Defined Extension Modules to Postgres</a></p>
<p><a href="https://idrawone.github.io/postgresql/eclipse/debug/2019/12/30/How-to-build-PostgreSQL-source-code-using-Eclipse-on-Ubuntu-18.04.html">2. How to build and debug PostgreSQL 12 using latest Eclipse IDE on Ubuntu 18.04</a></p>

        
      </div>
      <footer>
        
          
  
  <div class="categories">
    <a href="/categories/Postgres/">Postgres</a>, <a href="/categories/Postgres/Eclipse/">Eclipse</a>, <a href="/categories/Postgres/Eclipse/Test/">Test</a>, <a href="/categories/Postgres/Eclipse/Test/Debug/">Debug</a>, <a href="/categories/Postgres/Eclipse/Test/Debug/Extension/">Extension</a>
  </div>

          
          <div class="share">
  

    
      <div class="bdsharebuttonbox"><a href="#" class="bds_twi" data-cmd="twi" title="Share to Twitter"></a><a href="#" class="bds_fbook" data-cmd="fbook" title="Share to Facebook"></a><a href="#" class="bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a><a href="#" class="bds_weixin" data-cmd="weixin" title="Share to Wechat"></a><a href="#" class="bds_mail" data-cmd="mail" title="分享到邮件分享"></a><a href="#" class="bds_copy" data-cmd="copy" title="分享到复制网址"></a><a href="#" class="bds_sqq" data-cmd="sqq" title="Share to QQ Friends"></a><a href="#" class="bds_linkedin" data-cmd="linkedin" title="Share to linkedin"></a><a href="#" class="bds_youdao" data-cmd="youdao" title="分享到有道云笔记"></a><a href="#" class="bds_qzone" data-cmd="qzone" title="分享到QQ空间"></a><a href="#" class="bds_renren" data-cmd="renren" title="分享到人人网"></a><a href="#" class="bds_douban" data-cmd="douban" title="分享到豆瓣网"></a></div>
	  <script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":["mshare","bdysc","tqq","bdxc","kaixin001","tqf","tieba","douban","tsohu","bdhome","sqq","thx","qq","ibaidu","taobao","hi","baidu","sohu","t163","qy","meilishuo","mogujie","diandian","huaban","leho","share189","duitang","hx","tfh","fx","youdao","sdo","qingbiji","ifeng","people","xinhua","ff","mail","kanshou","isohu","yaolan","wealink","xg","ty","iguba","fbook","twi","deli","s51","s139","linkedin","copy","print"],"bdPic":"","bdStyle":"1","bdSize":"24"},"share":{},"image":{"viewList":["twi","fbook","tsina","weixin","mail","copy","sqq","linkedin","youdao","qzone","renren","douban"],"viewText":"Share to","viewSize":"24"}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];</script>
    

    

    
  
</div>
          

        
        <div class="clearfix"></div>
      </footer>
    </div>
</article>



<nav id="pagination" >
    
    
    <a href="/2019/12/30/How-to-build-PostgreSQL-source-code-using-Eclipse-on-Ubuntu-18.04/" class="alignright next" >Next</a>
    
    <div class="clearfix"></div>
</nav>


</div></div>
    <aside id="sidebar" class="alignright"><div class="padding">
	
	  <div class="search">
  <form action="//google.com/search" method="get" accept-charset="utf-8">
    <input type="search" autocomplete="off" name="q" maxlength="20" results="0" placeholder="Search">
    <input type="hidden" name="q" value="site:idrawone.github.io">
  </form>
</div>
	
	  
<div class="widget category">
  <h3 class="title">Categories</h3>
  <ul class="entry">
  
    <li><a href="/categories/PostgreSQL/Eclipse/Debug/">Debug</a><small>1</small></li>
  
    <li><a href="/categories/Postgres/Eclipse/Test/Debug/">Debug</a><small>1</small></li>
  
    <li><a href="/categories/Postgres/Eclipse/">Eclipse</a><small>1</small></li>
  
    <li><a href="/categories/PostgreSQL/Eclipse/">Eclipse</a><small>1</small></li>
  
    <li><a href="/categories/Postgres/Eclipse/Test/Debug/Extension/">Extension</a><small>1</small></li>
  
    <li><a href="/categories/PostgreSQL/">PostgreSQL</a><small>1</small></li>
  
    <li><a href="/categories/Postgres/">Postgres</a><small>1</small></li>
  
    <li><a href="/categories/Postgres/Eclipse/Test/">Test</a><small>1</small></li>
  
  </ul>
</div>

	
	  
<div class="widget recent-post">
  <h3 class="title">Recent Posts</h3>
  <ul class="entry">
    
      <li>
        <a href="/2019/12/31/How-to-create-debug-and-test-an-extension-written-in-C-for-PostgreSQL/">How to create, debug and test an extension written in C for PostgreSQL</a>
      </li>
    
      <li>
        <a href="/2019/12/30/How-to-build-PostgreSQL-source-code-using-Eclipse-on-Ubuntu-18.04/">How to build and debug PostgreSQL 12 using latest Eclipse IDE on Ubuntu 18.04</a>
      </li>
    
  </ul>
</div>

	
	  
	
	  <iframe width="100%" height="120" class="share_self"  frameborder="0" scrolling="no" src="http://widget.weibo.com/weiboshow/index.php?language=&width=0&height=550&fansRow=2&ptype=1&speed=0&skin=10&isTitle=1&noborder=1&isWeibo=0&isFans=0&uid=5594792135&verifier=676ff25e&dpc=1"></iframe>
	
	  <div class="widget category">
	<h3 class="title">Link</h3>
	<ul class="entry">
		
        	<li><a href="http://idrawone.blogspot.com/?view=flipcard" target="_blank" rel="noopener">Blogspot</a></li>
      	
        	<li><a href="http://idrawone.github.io/">Github</a></li>
      	
	</ul>
</div>
	
</div></aside>
    <div class="clearfix"></div>
  </div>
  <footer id="footer" class="inner"><div class="padding">
	<div class="alignleft">
	  
	  Copyright&copy;2013-2020 <a href=" / ">David Zhang</a>
	  
	  | Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
	  and Theme by <a href="https://github.com/hijiangtao/dark-tech/" target="_blank">Dark-Tech</a> | <script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_1000257487'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s96.cnzz.com/z_stat.php%3Fid%3D1000257487' type='text/javascript'%3E%3C/script%3E"));</script>
	</div>

	<div class="alignright">
		
		
			<a href="https://github.com/idrawone" target="_blank" title="David Zhang Github"><i class="fa fa-github-square"></i></a>	
		
		
		
			<a href="http://www.weibo.com/idrawone" target="_blank" title="David Zhang Weibo"><i class="fa fa-weibo"></i></a>	
		
		
		
		
	</div>

	<div class="clearfix"></div>
</div>

<div class="scroll-top"><i class="fa fa-arrow-circle-up"></i></div>
</footer>
  


<script src="//cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/3.0.4/jquery.imagesloaded.js"></script>
<script src="/js/gallery.js"></script>



<script type="text/javascript">
$(window).scroll(function() {

    if($(this).scrollTop() > 400) {
        $('.scroll-top').fadeIn(200);
    } else {
        $('.scroll-top').fadeOut(200);
    }
});

$('.scroll-top').bind('click', function(e) {
    e.preventDefault();
    $('body,html').animate({scrollTop:0},200);
});
</script>

</body>
</html>
